# MySQL 문자 집합
MySQL 서버에서 각 테이블의 칼럼은 모두 서로 다른 문자 집합을 사용해 문자열 값을 저장할 수 있다. 문자 집합은 문자열을 저장하는 CHAR, VARCHAR, TEXT 타입의 칼럼에만 설정할 수 있다. **MySQL에서 최종적으로는 칼럼 단위로 문자 집합을 관리**하지만 관리의 편의를 위해 MySQL 서버와 DB, 그리고 테이블 단위로 기본 문자 집합을 설정할 수 있는 기능을 제공한다. 즉 테이블의 문자 집합을 UTF-8 로 설정하면 칼럼의 문자 집합을 별도로 지정하지 않아도 해당 테이블에 속한 칼럼은 UTF-8 문자 집합을 사용한다. 물론 테이블의 기본 문자 집합이 UTF-8이라고 하더라도 각 칼럼에 대해 문자 집합을 EUC-KR이나 ASCII 등으로 별도 지정할 수 있다. 한글 기반의 서비스에서는 euckr 또는 utf8mb4 문자 집합을 사용하며, 일본어인 경우에는 Cp932 또는 utf8mb4를 적용하는 것이 일반적이다. 한글 윈도우에서 기본적으로 사용되는 MS949(MSWIN949) 문자 집합은 EUC-KR보다는 조금 더 확장된 형태의 문자 집합으로, 유닉스 계열의 운영체제에서 사용하는 CP949와 똑같은 문자 집합이다. MySQL 서버에서는 별도로 CP949라는 이름의 문자 집합은 지원하지 않고, EUC-KR만 지원한다. 실제로 CP949는 EUC-KR보다 더 많은 문자를 표현할 수 있는 문자 집합이다. 하지만 MySQL 5.5 버전부터는 euckr 문자 집합이 보완되어 CP949가 표현하는 모든 문 자 집합을 지원하므로 CP949 대신 euckr을 사용해도 아무런 문제없이 사용할 수 있다. 최근의 웹 서비스나 스마트폰 애플리케이션(앱, App)은 여러 나라의 언어를 동시에 지원하기 위해 기 본적으로 UTF-8 문자 집합(utf8mb4)을 사용하는 추세다. ANSI 표준에서는 하나의 문자 집합만 기본 으로 사용할 수 있는 DB에서 다국어를 지원할 수 있게끔 NCHAR 또는 NATIONAL CHAR와 같은 칼럼 타입을 정의하고 있다. MySQL에서도 NCHAR 타입을 지원하지만 기본적으로 MySQL에서는 칼럼 단위로 문자 집합을 선택할 수 있기 때문에 NCHAR 타입을 사용할 필요는 없다. MySQL에서 NCHAR 타입을 사용하면 UTF-8 문자 집합을 사용하는 CHAR 타입으로 생성된다. MySQL 서버에서 사용 가능한 문자 집합은 다음과 같이 "SHOW CHARACTER SET" 명령으로 확인해 볼 수 있다.

한국에서 MySQL을 사용한다면 대부분 euckr이나 utf8mb4만으로도 충분할 것이다. 

- latin 계열의 문자 집합은 알파벳이나 숫자, 그리고 키보드의 특수 문자로만 구성된 문자열만 저장해도 될 때 저장 공간을 절약하면서 사용할 수 있는 문자 집합이다(대부분 해시 값이나 16진수로 구성된 "Hex String" 또는 단순한 코드 값을 저장하는 용도로 사용한다). 
-euckr은 한국어 전용으로 사용되는 문자 집합이며, 모든 글자는 1~2바이트를 사용한다. 
- utf8mb4은 다국어 문자를 포함할 수 있는 칼럼에 사용하기에 적합하다. 칼럼의 문자 집합이 utf8mb4로 생성되면 일반적으로 디스크에 저장할 때는 한 글자를 저장하기 위해 1~4바이트까지 사용한다. 하지만 utf8mb4 문자 집합을 사용하는 문자열 값이 메모리에 기록(MEMORY 테이블이나 정렬 버퍼 등과 같은 용도에서)될 때는 실제 문자열의 길이와 관계없이 문자당 4바이트로 공간이 할당되는 경우도 있다. 
- utf8은 utf8mb4의 부분 집합인데, MySQL 서버에서 utf8mb4가 도입되기 이전에 주로 사용됐다. utf8 문자 집합 은 한 글자를 저장하기 위해 1~3바이트까지 사용한다. 한 글자를 저장하기 위한 공간이 최대 3바이트이기 때문에 utf8mb4보다는 저장할 수 있는 문자의 범위가 좁다. 

SHOW CHARACTER SET 명령의 결과에서 "Default collation" 칼럼에는 해당 문자 집합의 기본 콜레이션이 무엇인지 표시해준다. 기본 콜레이션이란 칼럼에 콜레이션은 명시하지 않고 문자 집합만 지정했을 때 설정되는 콜레이션을 의미한다.

MySQL에서는 문자 집합을 설정하는 시스템 변수가 여러 가지가 있는데, 모두 제각기 목적이 다르므로 주의해야 한다.

- character_set_system: MySQL 서버가 식별자(ldentifier, 테이블 명이나 칼럼 명 등)를 저장할 때 사용하는 문자 집합이다. 이 값은 기본적 으로 utf8로 설정되며, 사용자가 설정하거나 변경할 필요가 없다. 
- character_set_server: MySQL 서버의 기본 문자 집합이다. DB나 테이블 또는 칼럼에 아무런 문자 집합이 설정되지 않을 때 이 시스템 변수에 명시된 문자 집합이 기본으로 사용된다. 이 시스템 변수의 기본값은 utf8mb4다. 
- character_set_database MySQL DB의 기본 문자 집합이다. DB를 생성할 때 아무런 문자 집합이 명시되지 않았다면 이 시스템 변수에 명시 된 문자 집합이 기본값으로 사용된다. 이 변수가 정의되지 않으면 character_set_server 시스템 변수에 명시된 문자 집합이 기본으로 사용된다. 이 시스템 변수의 기본값은 utf8mb4이다. 
- character_set_filesystem: LOAD DATA INFILE 또는 SELECT INTO OUTFILE 문장을 실행할 때 인자로 지정되는 파일의 이름을 해석할 때 사용되는 문자 집합이다. 여기서 주의해야 할 것은 데이터 파일의 내용을 읽을 때 사용하는 문자 집합이 아니 라 파일의 이름을 찾을 때 사용하는 문자 집합이라는 점이다. 이 설정값은 각 커넥션에서 임의의 문자 집합으로 변 경해서 사용할 수 있다. 기본값은 binary인데, LOAD DATA INFILE 명령이나 SELECT INTO OUTFILE 명령에서 파 일명을 제대로 인식하지 못한다면 character_set_filesystem 시스템 변수를 utf8mb4로 변경하는 것이 좋다. 
- character_set_client: MySQL 클라이언트가 보낸 SQL 문장은 character_set_client에 설정된 문자 집합으로 인코딩해서 MySQL 서 버로 전송한다. 이 값은 각 커넥션에서 임의의 문자 집합으로 변경해서 사용할 수 있다. 기본값은 utf8mb40I다.SQL 문장에서 문자열 리터럴에 대해 인트로듀서가 사용된 경우에는 character_set_client 시스템 변수와 무관하게 개별적으로 설정된 문자 셋이 적용 된다. 
- character_set_connection: MySQL 서버가 클라이언트로부터 전달받은 SQL 문장을 처리하기 위해 character_set_connection의 문자 집합 으로 변환한다. 또한 클라이언트로부터 전달받은 숫자 값을 문자열로 변환할 때도 character_set_connection에 설정된 문자 집합이 사용된다. 이 변숫값 또한 각 커넥션에서 임의의 문자 집합으로 변경해서 사용할 수 있다. 기본값은 utf8mb4다. 

- character_set_results MySQL 서버가 쿼리의 처리 결과를 클라이언트로 보낼 때 사용하는 문자 집합을 설정하는 시스템 변수다. 이 시스템 변수도 각 커넥션에서 임의의 문자 집합으로 변경해서 사용할 수 있다. 기본값은 utf8mb4다.


![](https://velog.velcdn.com/images/chocochip/post/e058716e-daa8-420a-9583-1d2ba6408929/image.png)


## 클라이언트로부터 쿼리를 요청했을 때의 문자 집합 변환 
MySQL 서버는 클라이언트로부터 받은 메시지(SQL 문장과 변숫값)가 character_set_client에 지정된 문자 집합으로 인코딩돼 있다고 판단하고, 받은 문자열 데이터를 character_set_connection에 정의된 문자 집합으로 변환한다. 하지만 SQL 문장에 별도의 문자 집합이 지정된 리터럴(문자열)은 변환 대상 에 포함하지 않는다. SQL 문장에서 별도로 문자 집합을 설정하는 지정자를 "인트로듀서"라고 한다.

일반적으로 인트로듀서는 `_utf8mb4` 또는 `_latin1`과 같이 문자열 리터럴 앞 에 언더스코어 기호(`_`)와 문자 집합의 이름을 붙여서 표현한다. 

## 처리 결과를 클라이언트로 전송할 때의 문자 집합 변환

character_set_connection에 정의된 문자 집합으로 변환해 SQL을 실행한 다음, MySQL 서버는 퀴리의 결과(결과 셋이나 에러 메시지)를 character_set_results 변수에 설정된 문자 집합으로 변환해 클라이언트로 전송한다. 이때 결과 셋에 포함된 칼럼의 값이나 칼럼명과 같은 메타데이터도 모두 character_set_results로 인코딩되어 클라이언트로 전송된다. 그림 15.3의 전체 과정에서 변환 전의 문자 집합과 변환해야 할 문자 집합이 똑같다면 별도의 문자 집 합 변환 작업은 모두 생략한다. 예를 들어, 쿼리를 MySQL 서버로 전송할 때 character_set_client와 character_set_connection의 문자 집합이 똑같이 utf8mb4라면 MySQL 서버가 클라이언트로부터 퀴리 요청을 받아도 문자 집합은 변환되지 않는다. 결과를 클라이언트로 전송할 때도 character_set_results 와 칼럼의 문자 집합이 똑같다면 별도의 변환이 필요하지 않다. 여기서 문자 집합이라고만 표현했지만 문자 집합은 물론이고 콜레이션까지 포함해서 같은지 다른지를 비교한다. character_set_client와 character_set_results, character_set_connection이라는 3개의 시스템 설정 변 수에 대해서는 클라이언트 프로그램이나 클라이언트 GUI 도구에서 마음대로 변경할 수 있다. 즉, 이 시스템 설정 변수는 모두 세션 변수이면서 동적 변수다. 다음과 같이 이들 변수의 값을 한 번에 설정하 거나 개별적으로 변경할 수 있다. 

```sql
mysql> SET character_set_client = 'utf8mb4'; mysq1> SET character_set_results = 'utf8mb4'; mysq1> SET character_set_connection = 'utf8mb4'; mysq1> SET NAMES utf8mb4; mysq1> CHARSET utf8mb4;
```

위의 예제에서 처음 3개의 SET 명령은 각 설정값을 개별적으로 변경하는 명령이며, 나머지 2개의 명령 은 3개의 설정값을 한 번에 변경할 수 있는 명령이다. 예제 아래 쪽의 명령 2개도 조금 차이가 있다. SET NAMES 명령은 현재 접속된 커넥션에서만 유효하지만 CHARSET 명령은 MySQL 클라이언트 프로그램 이 재시작되지 않은 상태에서 재접속할 때도 문자 집합 설정이 유효하게 만들어 준다.
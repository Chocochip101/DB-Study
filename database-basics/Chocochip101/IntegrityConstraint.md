## 무결성 제약조건
데이터 무결성은 데이터베이스에 저장된 데이터의 일관성과 정확성을 지키는 것을 말한다. 일관성과 정확성을 잃어버린 데이터베이스는 정보로서의 가치에 심각한 문제가 있는 것이다. 일관성과 정확성을 가지고 구축된 데이터베이스가 계속해서 무결성을 유지하려면 튜플의 **삽입, 삭제, 수정** 시 데이터의 제약조건 준수 여부를 확인하여야 한다. 

실제 데이터의 삽입, 삭제, 수정에 관련된 문제는 응용 프로그램 개발 단계에서 프로그래머가 일일이 처리할 수 있다. 그러나 모든 경우를 감안하여 프로그램을 작성하기도 어렵고 향후 유지하기도 어렵다. 이 경우 데이터의 삽입, 삭제, 수정 시 필요한 기본적인 제약조건을 DBMS가 알아서 지켜준다면 프로그래머의 부담을 줄일 수 있다. 프로그래머는 데이터 변동에 따른 대응에 필요 이상의 시간을 투자하지 않고 프로그래밍에 집중할 수 있고, 소프트웨어의 성능 및 데이터의 신뢰성 향상에도 큰 도움을 줄 수 있다.

무결성 제약조건에는 튜플에 삽입 가능한 데이터의 값을 제한하는 도메인 무결성 제약조건과 관계 데이터 모델의 핵심적인 관계 표현을 위한 개체 무결성 제약 조건, 참조 무결성 제약 조건이 있다.

### 도메인 무결성 제약조건
도메인 무결성 제약조건은 도메인 제약이라고도 하며, **릴레이션 내의 투플들이 각 속성의 도메인에 지정된 값만을 가져야 한다는 조건**이다. 예를 들어 주문 릴레이션에서 주문일자는 날짜 데이터만 사용해야 한다. 만약 영문자 등의 다른 자료 형을 사용한다면 자료의 저장 및 검색에 큰 어려움이 따를 것이다. 도메인 무결성 제약조건은 속성 값과 관련된 무결성으로, SQL 문에서 데이터 형식, null/not null, 기본 값, 체크 등을 사용하여 지정할 수 있다.

### 개체 무결성 제약조건
개체 무결성 제약조건은 기본키 제약이라고도 한다. 릴레이션은 기본키를 지정하고 그에 따른 무결성 원칙 즉, **기본키는 NULL 값을 가져서는 안되며** 릴레이션 내에 오직 하나의 값만 존재해야 한다는 조건이다. 개체 무결성 제약조건은 참조 무결성 제약조건과 함께 관계 데이터 모델의 핵심 개념이다.

### 참조 무결성 제약조건
참조 무결성 제약조건은 외래키 제약이라고도 한다. 릴레이션 간의 참조 관계를 선언하는 제약조건이다. 일반적으로 참조되는(제공하는) 릴레이션을 부모 릴레이션, 참조하는(제공받는) 릴레이션을 자식 릴레이션이라고 한다. 참조 무결성 제약조건은 자식 릴레이션의 외래키는 부모 릴레이션의 기본키와 도메인이 동일해야 하며, 자식 릴레이션의 값이 변경될 때 부모 릴레이션의 제약을 받는다는 것이다. 즉 부모 릴레이션의 도메인과 다른 값으로 삽입, 수정될 경우 거부되고, 반대로 자식 릴레이션에서 참조하고 있는 값을 부모 릴레이션에서 삭제하거나 다른 값으로 변경하려고 하면 거부된다.

## 무결성 제약조건 수행
릴레이션은 데이터의 변경이 일어날 때 제약조건에 위배될 수 있다. 따라서 제약조건의 준수 여부는 **데이터의 변경(삽입, 수정, 삭제)**이 있을 때마다 확인해야 한다. 예를 들어 기존의 기본키와 같은 값을 가진 튜플을 삽입하거나, 기존의 기본키 값을 다른 투플의 기본키와 같은 값으로 변경한다면 그 연산은 거부된다. 또 부모 릴레이션에서 투플을 삭제할 경우 자식 릴레 이션도 같이 처리를 해야 한다. 

각각의 제약조건에 대해 데이터의 변경이 일어나면 어떻게 수행되는지 살펴보자.

### 개체 무결성 제약조건
관계 데이터베이스 시스템에서 DBMS는 투플을 삽입하거나 수정할 때마다 개체 무결성 제약 조건을 지키는지 확인한다. 즉 기본키 값이 유일한지, NULL 값이 아닌지를 검사한다. 만약 조건에 맞지 않으면 삽입 연산을 거부하고 오류 메시지를 보낸다. 


#### 삽입
새로운 튜플이 삽입되는 과정을 살펴보자. DBMS는 도메인 무결성 제약조건을 확인한 후 개체 무결성 제약조건을 수행하기 위해 학생 릴레이션을 살펴본다. 그런데 기본키인 학번에 이미 존재하면 삽입을 거부한다. 또 다른 PK가 NULL인 투플의 삽입 역시 기본키가 NULL이기 때문에 기존 투플을 검색할 필요도 없이 거부한다.

#### 수정
수정 연산 역시 삽입 연산과 동일한 제약에 따라 처리된다. 수정하려고 한다면 DBMS는 동일한 값이 존재하는지 검색한 후 수정을 거부한다.
#### 삭제
특별한 확인이 필요하지 않으며 즉시 수행한다. 단, 참조 무결성 제약조건에 의하여 학생 릴 레이션의 기본키를 다른 릴레이션에서 외래키로 참조하고 있으면 바로 삭제하지 않는다. 자 세한 내용은 이어서 설명하는 참조 무결성 제약조건에서 다룬다. 

### 참조 무결성 제약조건
참조 무결성 제약조건은 개체 무결성 제약조건과 달리 단일 릴레이션에 대한 내용이 아니다. 따라서 참조 무결성 제약조건을 준수하기 위해서는 두 릴레이션 간의 참조 관계에 따라 좀 더 복잡한 처리를 수행해야 한다. 부모 릴레이션(기본키가 참조되는 릴레이션)과 자식 릴레이션 (기본키를 참조하는 릴레이션)의 관계를 [그림 2-14]의 학생관리 데이터베이스를 통해 살펴 보자. 학과 릴레이션이 부모 릴레이션이고, 학생 릴레이션이 자식 릴레이션이다. 
#### 삽입
학생 릴레이션에 새로운 튜플이 삽입되는 과정을 살펴보자. DBMS는 먼저 도메인 무결성 제약조건을 확인한 후 개체 무결성 제약조건에 위배되는 값이 없는지 확인한다. 이후 PK가 부모 릴레이션의 기본키에 존재하는지 확인한다. 그런데 부모 릴레이션에 없으면 삽입은 거부된다. 이 경우 부모 릴레이션에 해당 PK를 삽입한 후 수행하면 정상적으로 진행된다. 참고로 릴레이션 생성 시 외래키인 PK 속성에 NULL 값을 허용하였다면 PK 값이 없어도 삽입이 가능하다.
#### 삭제
삽입과는 반대로 자식 릴레이션에서 투플이 삭제되는 경우 부모 릴레이션에는 아무런 영향을 주지 않으므로 바로 삭제가 가능하다. 그러나 부**모 릴레이션에서 튜플이 삭제되는 경우에는 문제가 발생할 수 있다.** 이 문제에 대한 조치 방법으로 다음과 같은 네 가지를 고려할 수 있다. 
- 즉시 작업을 중지 
- 자식 릴레이션의 관련 투플을 삭제 
- 초기에 설정된 다른 어떤 값으로 변경 
- NULL 값으로 설정 

이와 같이 DBMS는 부모 릴레이션에서 투플을 삭제할 때 참조 무결성 제약조건을 수행하기 위한 네 가지 옵션이 있다. 이는 제약조건 선언 시 자식 릴레이션에도 지정해주어야 한다. 

##### 참조 무결성 제약조건의 옵션(부모 릴레이션에서 투플을 삭제할 경우) 

|명령어|의미|예|
|---|---|---|
|RESTRICTED|자식 릴레이션에서 참조하고 있을 경우 부모 릴레이션의 삭제 작업을 거부함 |학과 릴레이션의 투플 삭제 거부|
|CASCADE|자식 릴레이션의 관련 투플을 같이 삭제함|학생 릴레이션의 관련 투플을 삭제|
|DEFAULT|자식 릴레이션의 관련 투플을 미리 설정해둔 값으로 변경함|학생 릴레이션의 학과가 다른 학과로 자동 배정 |
|NULL|자식 릴레이션의 관련 투플을 NULL 값으로 설정함(NULL 값을 허가한 경우)|학생 릴레이션의 학과가 NULL 값으로 변경|


#### 수정
수정은 삭제와 삽입 명령이 연속해서 수행된다고 보면 된다. 부모 릴레이션의 수정이 일어날 경우 삭제 옵션에 따라 처리된 후 문제가 없으면 다시 삽입 제약조건에 따라 처리된다.
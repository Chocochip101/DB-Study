## 락(Lock)
락은 트랜잭션이 데이터를 읽거나 수정할 때 데이터에 표시하는 잠금 장치이다. 락을 이용하여 자신이 사용할 데이터를 잠그면 다른 트랜잭션은 잠금이 풀릴 때까지 기다려야 한다. 락을 사용하면 데이터에 대한 갱신을 순차적으로 진행할 수 있기 때문에 갱신손실 문제를 해결할 수 있다.

### 락의 유형
락은 트랜잭션이 다루는 데이터를 다른 트랜잭션이 접근하리 못하도록 막아 대기 상태로 만든다. 다른 트랜잭션을 대기 상태로 만드는 일은 사용자의 응답 시간에 영향을 주기 때문에 가능한 최소화해야 한다. 

트랜잭션이 다루는 데이터는 읽기만 하는 데이터, 읽고 쓰는 데이터, 쓰기만 하는 데이터가 있다. 이 중에서 읽기만 하는 데이터가 있다. 이 중에서 읽기만하는 데이터를 다루는 트랜잭션은 어느 정도 허용해도 문제가 없다. 이 점을 고려하여 락의 유형을 두 가지로 분류한다.

#### 고유락 (Shared Lock 또는 Read Lock)

고유락은 여러 트랜잭션이 동일한 자원을 동시에 읽을 수 있도록 허용하는 락이다. 한 트랜잭션이 데이터를 읽고 있을 때, 다른 트랜잭션이 동일한 데이터를 읽을 수 있지만, 이때는 해당 데이터를 수정할 수 없다. 다수의 트랜잭션이 데이터를 읽는 경우에 사용되며, 서로 간섭 없이 읽을 수 있다.

#### 배타락 (Exclusive Lock 또는 Write Lock)

배타락은 특정 자원에 대한 읽기 및 쓰기 권한을 가진 트랜잭션이 독점적으로 해당 자원을 사용할 수 있도록 하는 락이다. 한 트랜잭션이 데이터를 쓰고 있을 때, 다른 트랜잭션이 동일한 데이터를 읽거나 쓸 수 없다. 데이터를 수정하는 경우나 쓰기 작업을 수행할 때 사용된다.


### 2단계 락킹
락을 사용하면 갱신 손실 문제를 해결할 수 있다. 하지만 락을 걸고 해제하는 시점에 제한을 두지 않으면 두 개의 트랜잭션이 동시에 실행될 때 데이터의 일관성이 깨질 수 있다. 

즉, 데이터에 락을 걸었다 풀고 다시 거는 중간 과정에 락의 해지 상태가 생기면서 다른 트랜잭션에게 중간 결과를 보일 수 있다는 것이다. 이것을 방지하기 위해 2단계 락킹 기법을 사용한다. 이 기법은 트랜잭션이 락을 걸고 해제하는 시점을 다음과 같이 2단계로 나누어 진행한다.

- 확장 단계: 트랜잭션이 필요한 락을 획득하는 단계로, 이 단계에서는 이미 획득한 락을 해체하지 않는다.
- 수축 단계: 트랜잭션이 락을 해제하는 단계로, 이 단계에서는 새로운 락을 획득하지 않는다.



### 데드락

2단계 락킹 방법을 사용하면 데이터의 일관성을 유지할 수 있다. 그렇지만 두 개 이상의 트랜잭션이 각각 자신의 데이터에 대하여 락을 획득하고 상대방 데이터에 대하여 락을 요청하면 무한 대기 상태에 빠질 수 있다. 이러한 현상을 데드락(Deadlock)이라 한다.

데드락은 대기 그래프를 그려 발생 여부를 판단할 수 있다. 대기 그래프는 트랜잭션을 노드로, 락 요청을 화살표로 표현한다. 대기 그래프에서 사이클이 존재하면 데드락이 발생한 것이다.